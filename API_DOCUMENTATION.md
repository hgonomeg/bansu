# Bansu

- **OpenAPI Version:** `3.1.0`
- **API Version:** `0.4.0-alpha`

Server-side computation API for Moorhen

## Operations

### GET /get\_cif/{job\_id}

- **Method:** `GET`
- **Path:** `/get_cif/{job_id}`
- **Tags:** 

For Acedrg jobs, streams the contents of the CIF file generated by Acedrg.

#### Responses

##### Status: 200 Success. Streams CIF file contents

###### Content-Type: text/plain

##### Status: 400 The given \`job\_id\` does not correspond to an \`Acedrg\` job or the job is still pending (or queued)

##### Status: 404 The given \`job\_id\` is not valid

##### Status: 500 Output file could not be read or other error

### POST /run\_acedrg

- **Method:** `POST`
- **Path:** `/run_acedrg`
- **Tags:** 

Creates `Acedrg` job.

#### Request Body

##### Content-Type: application/json

- **`commandline_args` (required)**

  `array` — Array of arguments for Acedrg . Note: not all Acedrg arguments are currently available

  **Items:**

  `string`

- **`smiles` (required)**

  `string` — Input SMILES string

**Example:**

```
{
  "commandline_args": [
    "-z",
    "--something"
  ],
  "smiles": "Your SMILES string"
}
```

#### Responses

##### Status: 201 Success (job spawned)

###### Content-Type: application/json

- **`error_message`**

  `string | null` — Null on success

- **`job_id`**

  `object`

- **`queue_position`**

  `integer | null` — Position counted from 0. Null if the job is being processed without a queue.

**Example:**

```
{
  "error_message": "Error message if the request failed",
  "job_id": "UUID of your job",
  "queue_position": 12
}
```

##### Status: 202 Success (job queued)

###### Content-Type: application/json

- **`error_message`**

  `string | null` — Null on success

- **`job_id`**

  `object`

- **`queue_position`**

  `integer | null` — Position counted from 0. Null if the job is being processed without a queue.

**Example:**

```
{
  "error_message": "Error message if the request failed",
  "job_id": "UUID of your job",
  "queue_position": 12
}
```

##### Status: 400 Input validation error

###### Content-Type: application/json

- **`error_message`**

  `string | null` — Null on success

- **`job_id`**

  `object`

- **`queue_position`**

  `integer | null` — Position counted from 0. Null if the job is being processed without a queue.

**Example:**

```
{
  "error_message": "Error message if the request failed",
  "job_id": "UUID of your job",
  "queue_position": 12
}
```

##### Status: 500 Other error

###### Content-Type: application/json

- **`error_message`**

  `string | null` — Null on success

- **`job_id`**

  `object`

- **`queue_position`**

  `integer | null` — Position counted from 0. Null if the job is being processed without a queue.

**Example:**

```
{
  "error_message": "Error message if the request failed",
  "job_id": "UUID of your job",
  "queue_position": 12
}
```

##### Status: 503 Server is currently at capacity and is unable to handle your request

###### Content-Type: application/json

- **`error_message`**

  `string | null` — Null on success

- **`job_id`**

  `object`

- **`queue_position`**

  `integer | null` — Position counted from 0. Null if the job is being processed without a queue.

**Example:**

```
{
  "error_message": "Error message if the request failed",
  "job_id": "UUID of your job",
  "queue_position": 12
}
```

### GET /vibe\_check

- **Method:** `GET`
- **Path:** `/vibe_check`
- **Tags:** 

Health check endpoint.

#### Responses

##### Status: 200 Server is up and running

###### Content-Type: application/json

- **`active_jobs` (required)**

  `integer` — Number of jobs currently being processed (or still available for downloading job results)

- **`uptime` (required)**

  `integer`, format: `int64` — Uptime in seconds

- **`version` (required)**

  `string` — Bansu version

- **`max_concurrent_jobs`**

  `integer | null` — Max number of jobs to be run in parallel

- **`max_queue_length`**

  `integer | null` — Max length of the queue or null if queue disabled

- **`queue_length`**

  `integer | null` — Length of the queue or null if queue disabled

**Example:**

```
{
  "active_jobs": 13,
  "max_concurrent_jobs": 10,
  "max_queue_length": 30,
  "queue_length": 12,
  "uptime": 986986,
  "version": "v0.4.0"
}
```

### GET /ws/{job\_id}

- **Method:** `GET`
- **Path:** `/ws/{job_id}`
- **Tags:** 

Opens a WebSocket connection which allows you to track the job's progress. Progress messages are sent in the following scenarios:

- When the connection gets established
- When the job status / `job_output` get updated
- Periodically, with interval specified in server configuration (useful for estimating how long it may take for a queued job to be processed)

Connection gets automatically closed if the job fails or completes.

For queued jobs which could not have been started, listening on a WebSocket also lets you know why it failed (including input validation failure and all oher errors).

The connection ignores all messages sent to it (responds only to Ping messages).

#### Request Body

##### Content-Type: application/json

- **`status` (required)**

  `string`, possible values: `"Pending", "Finished", "Failed", "Queued"` — Job status

- **`error_message`**

  `string | null` — Can be not-null only if the job failed. Currently, this only has value for \`SetupError\` failure reason

- **`failure_reason`**

  `object`

- **`job_output`**

  `object`

- **`queue_position`**

  `integer | null` — Only not-null if the job is queued

**Example:**

```
{
  "error_message": "Some error message",
  "failure_reason": "TimedOut | JobProcessError | SetupError",
  "job_output": {
    "stderr": "A string",
    "stdout": "A string"
  },
  "queue_position": "number | null",
  "status": "Pending | Finished | Failed | Queued"
}
```

#### Responses

##### Status: 101 Opens up WebSocket connection

##### Status: 404 The given \`job\_id\` is not valid

## Schemas

### AcedrgArgs

- **Type:**`object`

Contains input SMILES string and an array of additional arguments passed to Acedrg.

- **`commandline_args` (required)**

  `array` — Array of arguments for Acedrg . Note: not all Acedrg arguments are currently available

  **Items:**

  `string`

- **`smiles` (required)**

  `string` — Input SMILES string

**Example:**

```
{
  "commandline_args": [
    "-z",
    "--something"
  ],
  "smiles": "Your SMILES string"
}
```

### JobFailureInfo

- **Type:**`string`

**Example:**

### JobOutput

- **Type:**`object`

* **`stderr` (required)**

  `string`

* **`stdout` (required)**

  `string`

**Example:**

```
{
  "stderr": "",
  "stdout": ""
}
```

### JobSpawnReply

- **Type:**`object`

* **`error_message`**

  `string | null` — Null on success

* **`job_id`**

  `object`

* **`queue_position`**

  `integer | null` — Position counted from 0. Null if the job is being processed without a queue.

**Example:**

```
{
  "error_message": "Error message if the request failed",
  "job_id": "UUID of your job",
  "queue_position": 12
}
```

### JobStatusInfo

- **Type:**`string`

**Example:**

### String

- **Type:**`string`

**Example:**

### VibeCheckResponse

- **Type:**`object`

Response to a vibe check request

- **`active_jobs` (required)**

  `integer` — Number of jobs currently being processed (or still available for downloading job results)

- **`uptime` (required)**

  `integer`, format: `int64` — Uptime in seconds

- **`version` (required)**

  `string` — Bansu version

- **`max_concurrent_jobs`**

  `integer | null` — Max number of jobs to be run in parallel

- **`max_queue_length`**

  `integer | null` — Max length of the queue or null if queue disabled

- **`queue_length`**

  `integer | null` — Length of the queue or null if queue disabled

**Example:**

```
{
  "active_jobs": 13,
  "max_concurrent_jobs": 10,
  "max_queue_length": 30,
  "queue_length": 12,
  "uptime": 986986,
  "version": "v0.4.0"
}
```

### WsJobDataUpdate

- **Type:**`object`

* **`status` (required)**

  `string`, possible values: `"Pending", "Finished", "Failed", "Queued"` — Job status

* **`error_message`**

  `string | null` — Can be not-null only if the job failed. Currently, this only has value for \`SetupError\` failure reason

* **`failure_reason`**

  `object`

* **`job_output`**

  `object`

* **`queue_position`**

  `integer | null` — Only not-null if the job is queued

**Example:**

```
{
  "error_message": "Some error message",
  "failure_reason": "TimedOut | JobProcessError | SetupError",
  "job_output": {
    "stderr": "A string",
    "stdout": "A string"
  },
  "queue_position": "number | null",
  "status": "Pending | Finished | Failed | Queued"
}
```
