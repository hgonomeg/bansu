# Bansu

> Version 0.3.0-alpha

Server-side computation API for Moorhen

## Path Table

| Method | Path | Description |
| --- | --- | --- |
| GET | [/get_cif/{job_id}](#getget_cifjob_id) |  |
| POST | [/run_acedrg](#postrun_acedrg) |  |
| GET | [/ws/{job_id}](#getwsjob_id) |  |

## Reference Table

| Name | Path | Description |
| --- | --- | --- |
| AcedrgArgs | [#/components/schemas/AcedrgArgs](#componentsschemasacedrgargs) | Contains input SMILES string and an array of additional arguments passed to Acedrg. |
| JobFailureInfo | [#/components/schemas/JobFailureInfo](#componentsschemasjobfailureinfo) |  |
| JobOutput | [#/components/schemas/JobOutput](#componentsschemasjoboutput) |  |
| JobSpawnReply | [#/components/schemas/JobSpawnReply](#componentsschemasjobspawnreply) |  |
| JobStatusInfo | [#/components/schemas/JobStatusInfo](#componentsschemasjobstatusinfo) |  |
| String | [#/components/schemas/String](#componentsschemasstring) |  |
| WsJobDataUpdate | [#/components/schemas/WsJobDataUpdate](#componentsschemaswsjobdataupdate) |  |

## Path Details

***

### [GET]/get_cif/{job_id}

- Description  
For Acedrg jobs, streams the contents of the CIF file generated by Acedrg.

#### Responses

- 200 Success. Streams CIF file contents

`text/plain`

- 400 The given `job_id` does not correspond to an `Acedrg` job or the job is still pending (or queued)

- 404 The given `job_id` is not valid

- 500 Output file could not be read or other error

***

### [POST]/run_acedrg

- Description  
Creates `Acedrg` job.

#### RequestBody

- application/json

```ts
// Contains input SMILES string and an array of additional arguments passed to Acedrg.
{
  commandline_args?: string[]
  // Input SMILES string
  smiles: string
}
```

#### Responses

- 201 Success (job spawned)

`application/json`

```ts
{
  // Null on success
  error_message?: string | null
  job_id?: null | #/components/schemas/String
  // Position counted from 0. Null if the job is being processed without a queue.
  queue_position?: integer | null
}
```

- 202 Success (job queued)

`application/json`

```ts
{
  // Null on success
  error_message?: string | null
  job_id?: null | #/components/schemas/String
  // Position counted from 0. Null if the job is being processed without a queue.
  queue_position?: integer | null
}
```

- 400 Input validation error

`application/json`

```ts
{
  // Null on success
  error_message?: string | null
  job_id?: null | #/components/schemas/String
  // Position counted from 0. Null if the job is being processed without a queue.
  queue_position?: integer | null
}
```

- 500 Other error

`application/json`

```ts
{
  // Null on success
  error_message?: string | null
  job_id?: null | #/components/schemas/String
  // Position counted from 0. Null if the job is being processed without a queue.
  queue_position?: integer | null
}
```

- 503 Server is currently at capacity and is unable to handle your request

`application/json`

```ts
{
  // Null on success
  error_message?: string | null
  job_id?: null | #/components/schemas/String
  // Position counted from 0. Null if the job is being processed without a queue.
  queue_position?: integer | null
}
```

***

### [GET]/ws/{job_id}

- Description  
Opens a WebSocket connection which allows you to track the job's progress.  
Progress messages are sent in the following scenarios:  
  
* When the connection gets established  
* When the job status / `job_output` get updated  
* Periodically, with interval specified in server configuration (useful for estimating how long it may take for a queued job to be processed)  
  
Connection gets automatically closed if the job fails or completes.  
  
For queued jobs which could not have been started, listening on a WebSocket also lets you know why it failed (including input validation failure and all oher errors).  
  
The connection ignores all messages sent to it (responds only to Ping messages).  


#### RequestBody

- application/json

```ts
{
  // Can be not-null only if the job failed. Currently, this only has value for `SetupError` failure reason
  error_message?: string | null
  failure_reason?: null | #/components/schemas/JobFailureInfo
  job_output?: null | #/components/schemas/JobOutput
  // Only not-null if the job is queued
  queue_position?: integer | null
  status: enum[Pending, Finished, Failed, Queued]
}
```

#### Responses

- 101 Opens up WebSocket connection

- 404 The given `job_id` is not valid

## References

### #/components/schemas/AcedrgArgs

```ts
// Contains input SMILES string and an array of additional arguments passed to Acedrg.
{
  commandline_args?: string[]
  // Input SMILES string
  smiles: string
}
```

### #/components/schemas/JobFailureInfo

```ts
{
  "type": "string",
  "enum": [
    "TimedOut",
    "JobProcessError",
    "SetupError"
  ]
}
```

### #/components/schemas/JobOutput

```ts
{
  stderr: string
  stdout: string
}
```

### #/components/schemas/JobSpawnReply

```ts
{
  // Null on success
  error_message?: string | null
  job_id?: null | #/components/schemas/String
  // Position counted from 0. Null if the job is being processed without a queue.
  queue_position?: integer | null
}
```

### #/components/schemas/JobStatusInfo

```ts
{
  "type": "string",
  "enum": [
    "Pending",
    "Finished",
    "Failed",
    "Queued"
  ]
}
```

### #/components/schemas/String

```ts
{
  "type": "string"
}
```

### #/components/schemas/WsJobDataUpdate

```ts
{
  // Can be not-null only if the job failed. Currently, this only has value for `SetupError` failure reason
  error_message?: string | null
  failure_reason?: null | #/components/schemas/JobFailureInfo
  job_output?: null | #/components/schemas/JobOutput
  // Only not-null if the job is queued
  queue_position?: integer | null
  status: enum[Pending, Finished, Failed, Queued]
}
```